window.__require=function t(e,o,i){function r(s,c){if(!o[s]){if(!e[s]){var h=s.split("/");if(h=h[h.length-1],!e[h]){var u="function"==typeof __require&&__require;if(!c&&u)return u(h,!0);if(n)return n(h,!0);throw new Error("Cannot find module '"+s+"'")}s=h}var a=o[s]={exports:{}};e[s][0].call(a.exports,function(t){return r(e[s][1][t]||t)},a,a.exports,t,e,o,i)}return o[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<i.length;s++)r(i[s]);return r}({QuadTreeCtr:[function(t,e,o){"use strict";cc._RF.push(e,"6be3a146G9BtqJuUEjLhTZB","QuadTreeCtr");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.QuadTreeCtr=void 0;var s=t("./quad-tree"),c=t("./grid-item"),h=cc._decorator,u=h.ccclass,a=h.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.p_pfbBlock=null,e.levelColor=[],e.w=0,e.h=0,e.qtRoot=null,e._blockList=[],e.isMouseMoving=!1,e.mouseNode=null,e.waitCheckNodeQue=[],e._mouseDebugNode=null,e}return r(e,t),e.prototype.onLoad=function(){this.drawNode=new cc.Node,this.node.addChild(this.drawNode),this.drawNode.addComponent(cc.Graphics),this.draw=this.drawNode.getComponent(cc.Graphics),this.draw.lineWidth=2,this.draw.lineCap=cc.Graphics.LineCap.SQUARE,this.draw.lineJoin=cc.Graphics.LineJoin.MITER,this.draw.strokeColor=new cc.Color(255,0,0,255),this.node.on(cc.Node.EventType.MOUSE_MOVE,this._mouseMove,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._mouseLeave,this),this.w=this.node.width,this.h=this.node.height,this.createRange(this.w,this.h),this.qtRoot=new s.default({x:0,y:0,width:960,height:640},4,5),this.mouseNode={x:0,y:0,width:20,height:20},this._mouseDebugNode=new cc.Node("mouse");var t=this.createSingleTexture();this._mouseDebugNode.addComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t),this._mouseDebugNode.getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.CUSTOM,this._mouseDebugNode.setContentSize(cc.size(this.mouseNode.width,this.mouseNode.height)),this.node.addChild(this._mouseDebugNode),this._mouseDebugNode.setPosition(cc.Vec2.ZERO)},e.prototype._mouseMove=function(t){this.waitCheckNodeQue=[];var e=t.getLocation(),o=this.node.convertToNodeSpaceAR(e);this.mouseNode.x=o.x,this.mouseNode.y=o.y,this._mouseDebugNode.setPosition(o),this.qtRoot.getIndex(this.mouseNode)},e.prototype.updateTargetsInfo=function(t){for(var e=0;e<t.length;e++)t[e].getComponent(c.gridItem).check=!0,t[e].color=cc.Color.BLACK,t[e].getChildByName("debug_num").color=cc.Color.WHITE},e.prototype.resetTargetsColor=function(){this.waitCheckNodeQue.forEach(function(t){t.getComponent(c.gridItem).isCollision=!1,t.color=cc.Color.BLACK,t.getChildByName("debug_num").color=cc.Color.WHITE})},e.prototype._mouseLeave=function(){this.waitCheckNodeQue.forEach(function(t){t.getComponent(c.gridItem).isCollision=!0,t.color=cc.Color.WHITE})},e.prototype.createRange=function(){this.draw&&(this.draw.moveTo(-this.w/2,0),this.draw.lineTo(this.w/2,0),this.draw.moveTo(0,this.h/2),this.draw.lineTo(0,-this.h/2),this.draw.stroke())},e.prototype.addObj=function(t,e){var o;void 0===e&&(e=1);for(var i=0;i<e;i++){var r=cc.instantiate(this.p_pfbBlock);r.getComponent(c.gridItem).vx=this.randomNumBoth(-.5,.5),r.getComponent(c.gridItem).vy=this.randomNumBoth(-.5,.5),r.x=this.randomNumBoth(r.width/2,this.qtRoot.bounds.width-r.width/2),r.y=this.randomNumBoth(r.height/2,this.qtRoot.bounds.height-r.height/2),this.node.addChild(r);var n=null!==(o=this._blockList.length)&&void 0!==o?o:0;r.getComponent(c.gridItem).index=n,r.getChildByName("debug_num").getComponent(cc.Label).string=""+n,this._blockList.push(r),this.qtRoot.insert(r)}},e.prototype.drawQT=function(t){var e,o=this,i=t.bounds;if(t.quadrant.length)t.quadrant.forEach(function(t){o.drawQT(t)});else{this.draw.rect(i.x,i.y,i.width,i.height);var r=t.level;this.draw.strokeColor=null!==(e=this.levelColor[r])&&void 0!==e?e:cc.Color.BLACK,this.draw.stroke()}},e.prototype.loop=function(){this.qtRoot.clear();for(var t=0;t<this._blockList.length;t++){var e=this._blockList[t].getComponent(c.gridItem),o=this._isOutBound(this._blockList[t],this.qtRoot.bounds),i=o[0],r=o[1];i&&(e.vx=-e.vx),r&&(e.vy=-e.vy),e.check=!1,this._blockList[t].color=cc.Color.WHITE,this._blockList[t].getChildByName("debug_num").color=cc.Color.BLACK,this._blockList[t].x+=e.vx,this._blockList[t].y+=e.vy,this.qtRoot.insert(this._blockList[t])}},e.prototype._isOutBound=function(t,e){var o=t.x-t.anchorX*t.width*t.scaleX,i=t.x+(1-t.anchorX)*t.width*t.scaleX,r=t.y-t.anchorY*t.height*t.scaleY,n=t.y+(1-t.anchorY)*t.height*t.scaleY;return[o<e.x||i>e.width+e.x,r<e.y||n>e.y+e.height]},e.prototype.isOutOfRange=function(t,e){return t>e.value1||t<e.value2},e.prototype.randomNumBoth=function(t,e){var o,i=(e=(o=[Math.min(t,e),Math.max(t,e)])[1])-(t=o[0]),r=Math.random();return t+Math.floor(r*i)},e.prototype.update=function(t){this.qtRoot&&(this.draw.clear(),this.drawQT(this.qtRoot),this.loop(t),this.updateTargetsInfo(this.qtRoot.retrieve(this.mouseNode)))},e.prototype.createSingleTexture=function(){for(var t=new Uint8Array(16),e=0;e<2;++e)for(var o=0;o<2;++o)t[8*e+4*o+0]=255,t[8*e+4*o+1]=255,t[8*e+4*o+2]=255,t[8*e+4*o+3]=255;var i=new cc.Texture2D;return i.name="single color",i.initWithData(t,cc.Texture2D.PixelFormat.RGBA8888,2,2),i},n([a(cc.Prefab)],e.prototype,"p_pfbBlock",void 0),n([a([cc.Color])],e.prototype,"levelColor",void 0),n([u],e)}(cc.Component);o.QuadTreeCtr=d,cc._RF.pop()},{"./grid-item":"grid-item","./quad-tree":"quad-tree"}],"grid-item":[function(t,e,o){"use strict";cc._RF.push(e,"6e2359fggdOI6tvZtJwQG/L","grid-item");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.gridItem=void 0;var s=cc._decorator,c=s.ccclass,h=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isCollision=!1,e.check=!1,e.vx=0,e.vy=0,e.quadrant=-1,e.index=-1,e}return r(e,t),n([c],e)}(cc.Component));o.gridItem=h,cc._RF.pop()},{}],"quad-tree":[function(t,e,o){"use strict";var i;cc._RF.push(e,"64287cdqldCmr2IP+qU8/SX","quad-tree"),Object.defineProperty(o,"__esModule",{value:!0}),o.EQuadrant=void 0,function(t){t[t.None=-1]="None",t[t.First=0]="First",t[t.Second=1]="Second",t[t.Third=2]="Third",t[t.Fourth=3]="Fourth"}(i=o.EQuadrant||(o.EQuadrant={}));var r=function(){function t(t,e,o,i){this.maxLevel=5,this.maxLevel=o||4,this.bounds=t,this.maxObjects=e||10,this.level=i||0,this.objects=[],this.quadrant=[]}return t.prototype.split=function(){var e=this,o=this.level+1,i=this.bounds.width/2,r=this.bounds.height/2,n=this.bounds.x,s=this.bounds.y,c=[{x:n+i,y:s+r},{x:n,y:s+r},{x:n,y:s},{x:n+i,y:s}];this.quadrant=c.map(function(n){return new t({x:n.x,y:n.y,width:i,height:r},e.maxObjects,e.maxLevel,o)})},t.prototype.getIndex=function(t){var e=[],o=this.bounds.x+this.bounds.width/2,r=this.bounds.y+this.bounds.height/2,n=t.y<r,s=t.x<o,c=t.x+t.width>o,h=t.y+t.height>r;return h&&c&&e.push(i.First),s&&h&&e.push(i.Second),s&&n&&e.push(i.Third),c&&n&&e.push(i.Fourth),e},t.prototype.insert=function(t){var e=this;t&&(this.quadrant.length>0?this.getIndex(t).forEach(function(o){o!==i.None&&e.quadrant[o].insert(t)}):(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevel&&(0===this.quadrant.length&&this.split(),this.objects.forEach(function(t){e.getIndex(t).filter(function(t){return t!==i.None}).forEach(function(o){e.quadrant[o].insert(t)})}),this.objects.length=0)))},t.prototype.retrieve=function(t){var e=this,o=this.getIndex(t),r=this.objects;return this.quadrant.length>0&&o.filter(function(t){return t!==i.None}).forEach(function(o){r=r.concat(e.quadrant[o].retrieve(t))}),r=r.filter(function(t,e){return r.indexOf(t)>=e})},t.prototype.clear=function(){this.objects.length=0,this.quadrant.forEach(function(t){return t.clear()}),this.quadrant.length=0},t}();o.default=r,cc._RF.pop()},{}]},{},["QuadTreeCtr","grid-item","quad-tree"]);